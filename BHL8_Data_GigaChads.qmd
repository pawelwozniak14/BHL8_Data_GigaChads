---
title: "Utrzymanie maszyn w funkcjonowaniu magazynu"
execute:
  echo: false
  warning: false
---

```{r}
library(tidyverse)
library(ggcorrplot)
library(gridExtra)

load("data/model_data.rda")
load("plots/eda_p.rda")
```

## Zrozumienie danych

Wybrane przez nas zadanie analityczne dotyczy predykcji uszkodzenia maszyn magazynowych oraz analiza wrażliwości wybranych modeli.

Opracowywany zbiór danych zawiera następujące zmienne

-   UID - unikalny identyfikator

-   Product_ID - Numer seryjny produktu

-   Type - wariant jakościowy produktu

-   Air_temperature - temperatura powietrza w pokoju

-   Process_temperature - temperatura w której wykonywany jest proces

-   Rotational_speed - częstotliwość obrotowa

-   Torque - moment obrotowy

-   Tool_wear - czas pracy w minutach danego narzędzia

-   Machine_failure - czy wystąpiła usterka

Oraz wyszczególnione powody usterek:

-   TWF - tool wear failure - uszkodzenie narzędzia

-   HDF - heat dissipation failure - szkoda powstała w wyniku rozproszenia ciepłą

-   PWF - power failure - usterk energetyczna

-   OSF - overstrain failure - przeciążenie maszyny

-   RNF - random failures - losowe uszkodzenia

```{r}
model.matrix(~0+., data=model_data[,-c(1:2)]) %>% 
  cor(use="pairwise.complete.obs") %>% 
  ggcorrplot(show.diag=FALSE, type="lower", lab=TRUE, lab_size=2)
```

Z macierzy korelacji widać, że ustreki maszy (co logczine) skorelowane są z poszczególnymi typami problemów funkcjonowania, lecz co ciekawe losowe usterki nie mają żadnego wpływu na pracę maszyn.

Pozostałe silne korelacje również sa intuicyjnie logiczne tj. temperatura powietrza z temperaturą procesu oraz częstotliwość obrotowa z momentem obrotowym.

```{r}
grid.arrange(p1,p2,ncol=1)
```

Wykresy rozkładu temperatur w przypadku powietrza sugeruje platokurtyczność oraz dla usterek maszyn dwumodalność z częstszym występowaniem w wyższych zakresach.
Podobne zjawisko można zaobserwować dla temperatury procesu lecz kurtoza bliższa jest rozkładu normalnego dzięki czemu dla rozkładu w których występowały usterki uwydacznia się lewostronna asymetria.
Możliwe że konieczne będzie transformowanie zmiennych dla lepszych rezultatów.

```{r}
grid.arrange(p3,p4,ncol=1)
```

Rozkłady częstotliwości obrotowej niezależnie od występowania usterki maszyny kształtem przypominają rozkład $\chi^2$ ze względu na bardzo silną asymetrię prawostronną.
Natomiast w przypadku momentu obrotowego dla braku usterki rozkład kształtem przypomina dzwon Gaussa ze średnią 40. Powyżej tej wartości w rozkładzie obserwacji, gdzie wystąpiła usterka widać nagły wzrost częstości występowania uszkodzeń.

```{r}
grid.arrange(p5,p6,ncol=1)
```

Rozkład zużycia narzędzia do dwusetnej minuty jest jednostajny, natomiast powyżej tej wartości następuje gwałtowny wzrost częstotliwości występowania usterek, pozwala to podejrzewać że jest to istotna zmienna w kontekście utrzymania maszyn.

Dodatkowo widać bardzo silne niezbalansowanie klas w przypadku usterek, będzie to wymagało uwzględnienia w przypadku budowania modeli uczenia maszynowego, szczególnie że jesto to zmienna która będzie przewidywana i dookoła której prowadzona będzie optymalizacja.

## Budowa modeli uczenia maszynowego

Ze względu na silne niezrównoważenie klas zaobserwowane w części eksploracyjnej zdecydowaliśmy się na zastosowanie metody upsamplingu w technice SMOTE (Synthetic Minority Oversampling Technique) chcąc uniknąć zjawiska nadmiernego dopasowania przy jednoczesnym zachowaniu jakości predykcji.

Modele uczenia maszynowego zbudowane na cele zadania:

-   Random forest

-   Decision tree

-   Suport vector machine

-   K-Nearest Nighbors

-   Neural network

-   XGBoost

-   Linear regression

