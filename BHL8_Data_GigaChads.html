<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Utrzymanie maszyn w funkcjonowaniu magazynu</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="BHL8_Data_GigaChads_files/libs/clipboard/clipboard.min.js"></script>
<script src="BHL8_Data_GigaChads_files/libs/quarto-html/quarto.js"></script>
<script src="BHL8_Data_GigaChads_files/libs/quarto-html/popper.min.js"></script>
<script src="BHL8_Data_GigaChads_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="BHL8_Data_GigaChads_files/libs/quarto-html/anchor.min.js"></script>
<link href="BHL8_Data_GigaChads_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="BHL8_Data_GigaChads_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="BHL8_Data_GigaChads_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="BHL8_Data_GigaChads_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="BHL8_Data_GigaChads_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="BHL8_Data_GigaChads_files/libs/tabwid-1.0.0/tabwid.css" rel="stylesheet">
<link href="BHL8_Data_GigaChads_files/libs/tabwid-1.0.0/scrool.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Utrzymanie maszyn w funkcjonowaniu magazynu</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">

</div>
<section id="zrozumienie-danych" class="level2">
<h2 class="anchored" data-anchor-id="zrozumienie-danych">Zrozumienie danych</h2>
<p>Wybrane przez nas zadanie analityczne dotyczy predykcji uszkodzenia maszyn magazynowych oraz analiza wrażliwości wybranych modeli.</p>
<p>Opracowywany zbiór danych zawiera następujące zmienne</p>
<ul>
<li><p>UID - unikalny identyfikator</p></li>
<li><p>Product_ID - Numer seryjny produktu</p></li>
<li><p>Type - wariant jakościowy produktu</p></li>
<li><p>Air_temperature - temperatura powietrza w pokoju</p></li>
<li><p>Process_temperature - temperatura w której wykonywany jest proces</p></li>
<li><p>Rotational_speed - częstotliwość obrotowa</p></li>
<li><p>Torque - moment obrotowy</p></li>
<li><p>Tool_wear - czas pracy w minutach danego narzędzia</p></li>
<li><p>Machine_failure - czy wystąpiła usterka</p></li>
</ul>
<p>Oraz wyszczególnione powody usterek:</p>
<ul>
<li><p>TWF - tool wear failure - szkoda powstała w wyniku zużycie narzędzia</p></li>
<li><p>HDF - heat dissipation failure - szkoda powstała w wyniku dysypacji ciepła</p></li>
<li><p>PWF - power failure - usterka z powodów energetycznych</p></li>
<li><p>OSF - overstrain failure - przeciążenie maszyny</p></li>
<li><p>RNF - random failures - losowe uszkodzenia</p></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<p><img src="BHL8_Data_GigaChads_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Z macierzy korelacji widać, że ustreki maszy (co logczine) skorelowane są z poszczególnymi typami problemów funkcjonowania, lecz co ciekawe losowe usterki nie mają żadnego wpływu na pracę maszyn.</p>
<p>Pozostałe silne korelacje również sa intuicyjnie logiczne tj. temperatura powietrza z temperaturą procesu oraz częstotliwość obrotowa z momentem obrotowym.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="BHL8_Data_GigaChads_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Wykresy rozkładu temperatur w przypadku powietrza sugeruje platokurtyczność oraz dla usterek maszyn dwumodalność z częstszym występowaniem w wyższych zakresach. Podobne zjawisko można zaobserwować dla temperatury procesu lecz kurtoza bliższa jest rozkładu normalnego dzięki czemu dla rozkładu w których występowały usterki uwydacznia się lewostronna asymetria. Możliwe że konieczne będzie transformowanie zmiennych dla lepszych rezultatów.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="BHL8_Data_GigaChads_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Rozkłady częstotliwości obrotowej niezależnie od występowania usterki maszyny kształtem przypominają rozkład <span class="math inline">\(\chi^2\)</span> ze względu na bardzo silną asymetrię prawostronną. Natomiast w przypadku momentu obrotowego dla braku usterki rozkład kształtem przypomina dzwon Gaussa ze średnią 40. Powyżej tej wartości w rozkładzie obserwacji, gdzie wystąpiła usterka widać nagły wzrost częstości występowania uszkodzeń.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="BHL8_Data_GigaChads_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Rozkład zużycia narzędzia do dwusetnej minuty jest jednostajny, natomiast powyżej tej wartości następuje gwałtowny wzrost częstotliwości występowania usterek, pozwala to podejrzewać że jest to istotna zmienna w kontekście utrzymania maszyn.</p>
<p>Dodatkowo widać bardzo silne niezbalansowanie klas w przypadku usterek, będzie to wymagało uwzględnienia w przypadku budowania modeli uczenia maszynowego, szczególnie że jesto to zmienna która będzie przewidywana i dookoła której prowadzona będzie optymalizacja.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="BHL8_Data_GigaChads_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="1920"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="BHL8_Data_GigaChads_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Najczęściej występującym typem usterki jest ta powstała w wyniku dyssypacji ciepła, drugim najczęstszym powodem wystąpienia usterek jest przeciążenie maszyny w nieznacznie mniejszej ilości przypadków jest to usterka z przyczyn energetycznych. Znacząco rzedziej występującym czynnikiem jest zużycie narzędzia, najrzadziej występujacą przyczyną są losowe uszkodzenia.</p>
</section>
<section id="budowa-modeli-uczenia-maszynowego" class="level2">
<h2 class="anchored" data-anchor-id="budowa-modeli-uczenia-maszynowego">Budowa modeli uczenia maszynowego</h2>
<p>Ze względu na silne niezrównoważenie klas zaobserwowane w części eksploracyjnej zdecydowaliśmy się na zastosowanie metody upsamplingu w technice SMOTE (Synthetic Minority Oversampling Technique) chcąc uniknąć zjawiska nadmiernego dopasowania przy jednoczesnym zachowaniu jakości predykcji.</p>
<p>Modele uczenia maszynowego zbudowane na cele zadania:</p>
<ul>
<li><p><em>Random Forest</em></p></li>
<li><p><em>Decision Tree</em></p></li>
<li><p><em>Support Vector Machine</em></p></li>
<li><p><em>K-Nearest Neighbors</em></p></li>
<li><p><em>Bagging</em></p></li>
<li><p><em>XGBoost</em></p></li>
<li><p><em>Logistic Regression</em></p></li>
</ul>
<p>Istotnym celem budowy powyższych modeli jest jak najlepsza jakość predykcyjna. Jest ona potrzebna do poprawnego wnioskowania podczas analizy wrażliwości - w końcu, czy moglibyśmy zaufać takiej analizie bez zbudowania bardzo dobrego modelu? Uznajemy, że w logistyce bardzo ważna jest sprawność maszyn i celem nadrzędnym jest maksymalizacja specificity, co sprawi, że jeśli nasza predykcja będzie się mylić to będzie to robić częściej w taki sposób, że będziemy obawiać się usterki, mimo że ona się nie wydarzy, za to będzie niewiele przypadków, gdzie umknie nam zagrożenie. Uchronienie maszyny przed zepsuciem nie tylko sprawia, że oszczędzimy pieniądze na naprawie, ale również magazyn będzie bardziej efektywny, ponieważ nie stracimy ważnego narzędzia na czas naprawy.</p>
<p>Dostroiliśmy hiperparametry modeli korzystając z walidacji krzyżowej, przeszukiwania siatki latin hypercube oraz optymalizując wyniki modelu pod względem specificity. Miary dopasowania dla wyżej wymienionych modeli wyglądają następująco:</p>
<div class="cell">
<div class="cell-output-display">

<div class="tabwid"><style>.cl-026dcfea{}.cl-02659a82{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-0265b5d0{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-0265b5e4{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-0266135e{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-02661368{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-02661369{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-02661372{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-02661386{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-02661387{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class="cl-026dcfea">
<thead><tr style="overflow-wrap:break-word;"><td class="cl-02661387"><p class="cl-0265b5d0"><span class="cl-02659a82">Metric</span></p></td><td class="cl-02661386"><p class="cl-0265b5e4"><span class="cl-02659a82">Random Forest</span></p></td><td class="cl-02661386"><p class="cl-0265b5e4"><span class="cl-02659a82">XGBoost</span></p></td><td class="cl-02661386"><p class="cl-0265b5e4"><span class="cl-02659a82">Support Vector Machines</span></p></td><td class="cl-02661386"><p class="cl-0265b5e4"><span class="cl-02659a82">Decision Tree</span></p></td><td class="cl-02661386"><p class="cl-0265b5e4"><span class="cl-02659a82">Logistic Regression</span></p></td><td class="cl-02661386"><p class="cl-0265b5e4"><span class="cl-02659a82">K-Nearest Neighbors</span></p></td><td class="cl-02661386"><p class="cl-0265b5e4"><span class="cl-02659a82">Naive Bayes</span></p></td><td class="cl-02661386"><p class="cl-0265b5e4"><span class="cl-02659a82">Bagging</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-02661368"><p class="cl-0265b5d0"><span class="cl-02659a82">F1 score</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.9807451</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.9291234</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.9461806</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.9467275</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.8999547</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.9661017</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.9182810</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.9809504</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-02661368"><p class="cl-0265b5d0"><span class="cl-02659a82">Accuracy</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.9632000</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.8716000</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.9008000</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.9020000</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.8232000</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.9360000</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.8532000</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.9636000</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-02661368"><p class="cl-0265b5d0"><span class="cl-02659a82">Sensitivity</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.9709905</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.8719436</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.9034397</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.9021964</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.8238707</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.9448819</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.8545379</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.9709905</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-02661368"><p class="cl-0265b5d0"><span class="cl-02659a82">Specificity</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.7471264</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.8620690</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.8275862</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.8965517</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.8045977</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.6896552</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.8160920</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.7586207</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-02661368"><p class="cl-0265b5d0"><span class="cl-02659a82">Recall</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.9709905</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.8719436</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.9034397</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.9021964</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.8238707</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.9448819</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.8545379</span></p></td><td class="cl-0266135e"><p class="cl-0265b5e4"><span class="cl-02659a82">0.9709905</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-02661369"><p class="cl-0265b5d0"><span class="cl-02659a82">J index</span></p></td><td class="cl-02661372"><p class="cl-0265b5e4"><span class="cl-02659a82">0.7181169</span></p></td><td class="cl-02661372"><p class="cl-0265b5e4"><span class="cl-02659a82">0.7340126</span></p></td><td class="cl-02661372"><p class="cl-0265b5e4"><span class="cl-02659a82">0.7310259</span></p></td><td class="cl-02661372"><p class="cl-0265b5e4"><span class="cl-02659a82">0.7987482</span></p></td><td class="cl-02661372"><p class="cl-0265b5e4"><span class="cl-02659a82">0.6284684</span></p></td><td class="cl-02661372"><p class="cl-0265b5e4"><span class="cl-02659a82">0.6345371</span></p></td><td class="cl-02661372"><p class="cl-0265b5e4"><span class="cl-02659a82">0.6706299</span></p></td><td class="cl-02661372"><p class="cl-0265b5e4"><span class="cl-02659a82">0.7296112</span></p></td></tr></tbody></table></div>
</div>
</div>
<p>Krzywe AUC-ROC</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="BHL8_Data_GigaChads_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Do analizy wrażliwości wybraliśmy Random Forest ze względu na dobry wynik AUC-ROC, Decision Tree ze względu na najlepszy wynik specificity oraz Support Vector Machines i XGBoost ze względu na drugi oraz trzeci wynik ze względu na AUC-ROC i specificity.</p>
</section>
<section id="kontrola-jakości-i-analiza-wyników" class="level2">
<h2 class="anchored" data-anchor-id="kontrola-jakości-i-analiza-wyników">Kontrola jakości i analiza wyników</h2>
<div class="cell">
<div class="cell-output-display">
<p><img src="BHL8_Data_GigaChads_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="BHL8_Data_GigaChads_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="768"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="BHL8_Data_GigaChads_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid" width="768"></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="BHL8_Data_GigaChads_files/figure-html/unnamed-chunk-11-3.png" class="img-fluid" width="768"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="BHL8_Data_GigaChads_files/figure-html/unnamed-chunk-11-4.png" class="img-fluid" width="768"></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="BHL8_Data_GigaChads_files/figure-html/unnamed-chunk-11-5.png" class="img-fluid" width="768"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="BHL8_Data_GigaChads_files/figure-html/unnamed-chunk-11-6.png" class="img-fluid" width="768"></p>
</div>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>